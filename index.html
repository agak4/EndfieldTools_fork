<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê¸°ì§ˆ ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì•„ì½”ë””ì–¸ ì• ë‹ˆë©”ì´ì…˜ */
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .details-open .details-content { max-height: 800px; transition: max-height 0.5s ease-in; }
        .arrow-icon { transition: transform 0.3s; }
        .details-open .arrow-icon { transform: rotate(180deg); }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center text-blue-400">ê¸°ì§ˆ ê³„ì‚°ê¸°</h1>

        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8 border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <label class="font-semibold text-gray-300">ğŸ” ê¸°ì§ˆ í•„í„°</label>
                <button onclick="resetFilters()" class="text-sm text-gray-500 hover:text-white underline">ì „ì²´ ì´ˆê¸°í™”</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-blue-400 uppercase tracking-widest border-b border-gray-700 pb-1">ëŠ¥ë ¥ì¹˜</h3>
                    <div id="tags-stats" class="flex flex-wrap gap-2"></div>
                </div>
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-green-400 uppercase tracking-widest border-b border-gray-700 pb-1">ì†ì„±</h3>
                    <div id="tags-attrs" class="flex flex-wrap gap-2"></div>
                </div>
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-purple-400 uppercase tracking-widest border-b border-gray-700 pb-1">ì‹œë¦¬ì¦ˆ ìŠ¤í‚¬</h3>
                    <div id="tags-series" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>

        <div id="decision-box" class="mb-6 p-6 rounded-xl border-2 transition-all duration-300 flex flex-col items-center justify-center text-center shadow-inner hidden">
            </div>

        <div class="grid grid-cols-12 gap-4 px-6 py-3 bg-gray-700 rounded-t-xl font-black text-gray-200 text-base">
            <div class="col-span-5 md:col-span-4">ë¬´ê¸° ì´ë¦„</div>
            <div class="hidden md:block col-span-3 text-center">ì¶”ì²œ ìºë¦­í„°</div>
            <div class="col-span-7 md:col-span-5 text-right md:text-left">ê¸°ì§ˆ</div>
        </div>
        
        <div id="weapon-list" class="bg-gray-800 rounded-b-xl shadow-2xl divide-y divide-gray-700 border-x border-b border-gray-700">
            </div>
    </div>

    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ---
        let weapons = [];
        let allTags = [];
        let activeTags = new Set();

        // --- ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ ---
        async function loadData() {
            try {
                const response = await fetch('data.json');
                weapons = await response.json();
                allTags = [...new Set(weapons.flatMap(w => w.tags))].sort();
                renderTags();
                updateUI();
            } catch (error) {
                console.error("Data load error:", error);
                document.getElementById('weapon-list').innerHTML = `<div class="p-12 text-center text-red-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>`;
            }
        }

        // --- ì„¤ì • ë°ì´í„° ---
        const CATEGORIES = {
            stats: ["ë¯¼ì²© ì¦ê°€", "í˜ ì¦ê°€", "ì˜ì§€ ì¦ê°€", "ì§€ëŠ¥ ì¦ê°€", "ì£¼ìš” ëŠ¥ë ¥ì¹˜ ì¦ê°€"],
            series: ["ê°•ê³µ", "ì–µì œ", "ì¶”ê²©", "ë¶„ì‡„", "ì‚¬ê¸°", "ê¸°ì˜ˆ", "ì”í˜¹", "ê³ í†µ", "ì˜ë£Œ", "ê³¨ì ˆ", "ë°©ì¶œ", "ì–´ë‘ ", "íë¦„", "íš¨ìœ¨"]
        };

        // --- ìŠ¤íƒ€ì¼ í—¬í¼ í•¨ìˆ˜ ---
        function getRarityStyles(rarity) {
            switch(parseInt(rarity)) {
                case 6: return { text: 'text-orange-400', badge: 'text-orange-400 border-orange-400/50 bg-orange-400/10 shadow-[0_0_8px_rgba(251,146,60,0.2)]' };
                case 5: return { text: 'text-yellow-200', badge: 'text-yellow-200 border-yellow-200/50 bg-yellow-200/10' };
                case 4: return { text: 'text-purple-300', badge: 'text-purple-300 border-purple-300/50 bg-purple-300/10' };
                default: return { text: 'text-blue-200', badge: 'text-blue-200 border-blue-200/50 bg-blue-200/10' };
            }
        }

        // --- [ìˆ˜ì •ë¨] ë¡œì§ í•¨ìˆ˜: ê°€ì´ë“œ ë°•ìŠ¤ ì—…ë°ì´íŠ¸ ---
        function updateDecisionBox(filteredWeapons) {
            const box = document.getElementById('decision-box');
            box.classList.remove('hidden');

            // 1. ì˜µì…˜ ë¯¸ì„ íƒ ì‹œ
            if (activeTags.size === 0) {
                box.className = "mb-6 p-6 rounded-xl border-2 border-dashed border-gray-600 bg-gray-800/50 text-gray-400 flex flex-col items-center justify-center text-center";
                box.innerHTML = `
                    <p class="text-lg font-bold">ğŸ’¡ ê¸°ì§ˆ í•„í„°ì—ì„œ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                    <p class="text-sm opacity-70">ì„ íƒí•˜ì‹  ì¡°í•©ì— 6ì„± ë¬´ê¸°ê°€ í¬í•¨ë˜ëŠ”ì§€ í™•ì¸í•´ ë“œë¦½ë‹ˆë‹¤.</p>
                `;
                return;
            }

            // 2. [ìˆ˜ì •] ê²°ê³¼ ì—†ìŒ = ê°ˆì•„! (ì¡°í•© ì—†ìŒ)
            if (filteredWeapons.length === 0) {
                box.className = "mb-6 p-6 rounded-xl border-4 border-gray-500 bg-gray-700 text-gray-300 flex flex-col items-center justify-center text-center";
                box.innerHTML = `
                    <h2 class="text-3xl font-black mb-1">ğŸ—‘ï¸ ê°ˆì•„! (ì¡°í•© ì—†ìŒ)</h2>
                    <p class="text-sm font-bold">ì´ ì¡°í•©ì„ ì‚¬ìš©í•˜ëŠ” ë¬´ê¸°ê°€ ì•„ì˜ˆ ì—†ìŠµë‹ˆë‹¤.</p>
                `;
                return;
            }

            // 3. ê²°ê³¼ ìˆìŒ - ìµœê³  ë“±ê¸‰ ê³„ì‚°
            const maxRarity = Math.max(...filteredWeapons.map(w => w.rarity || 0));

            if (maxRarity >= 6) {
                // [ìˆ˜ì •] ì˜µì…˜ ê°œìˆ˜ì— ë”°ë¥¸ ë¶„ê¸° ì²˜ë¦¬
                if (activeTags.size >= 2) {
                    // ì˜µì…˜ 2ê°œ ì´ìƒ + 6ì„± ìˆìŒ -> "ê°ˆì§€ë§ˆ!" (ê°•ë ¥ ê²½ê³ )
                    box.className = "mb-6 p-6 rounded-xl border-4 border-orange-500 bg-orange-900/30 text-orange-400 animate-pulse flex flex-col items-center justify-center text-center";
                    box.innerHTML = `
                        <h2 class="text-3xl font-black mb-1">ğŸš« ê°ˆì§€ë§ˆ! (ì ˆëŒ€ ë³´ì¡´)</h2>
                        <p class="text-sm font-bold">ì„ íƒí•˜ì‹  ì¡°í•©ì„ í•µì‹¬ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” 6ì„± ë¬´ê¸°ê°€ ìˆìŠµë‹ˆë‹¤.</p>
                    `;
                } else {
                    // ì˜µì…˜ 1ê°œ + 6ì„± ìˆìŒ -> "6ì„± í¬í•¨" (ë‹¨ìˆœ ì•ˆë‚´)
                    box.className = "mb-6 p-6 rounded-xl border-4 border-orange-400/60 bg-orange-900/10 text-orange-300 flex flex-col items-center justify-center text-center";
                    box.innerHTML = `
                        <h2 class="text-3xl font-black mb-1">âœ¨ 6ì„± í¬í•¨ (ë³´ì¡´ ê¶Œì¥)</h2>
                        <p class="text-sm font-bold">ì´ ê¸°ì§ˆì„ ì‚¬ìš©í•˜ëŠ” 6ì„± ë¬´ê¸°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. (ë‹¤ë¥¸ ì˜µì…˜ê³¼ ì¡°í•©í•´ë³´ì„¸ìš”)</p>
                    `;
                }
            } else if (maxRarity === 5) {
                // 5ì„± -> "ê³ ë ¤"
                box.className = "mb-6 p-6 rounded-xl border-4 border-yellow-400 bg-yellow-900/30 text-yellow-200 flex flex-col items-center justify-center text-center";
                box.innerHTML = `
                    <h2 class="text-3xl font-black mb-1">âš ï¸ ê³ ë ¤ (ì‹ ì¤‘íˆ ê²°ì •)</h2>
                    <p class="text-sm font-bold">ìµœëŒ€ 5ì„± ë¬´ê¸°ê¹Œì§€ë§Œ ì‚¬ìš©í•˜ëŠ” ê¸°ì§ˆì…ë‹ˆë‹¤.</p>
                `;
            } else {
                // 4ì„± ì´í•˜ -> "ê°ˆì•„!"
                box.className = "mb-6 p-6 rounded-xl border-4 border-gray-500 bg-gray-700 text-gray-300 flex flex-col items-center justify-center text-center";
                box.innerHTML = `
                    <h2 class="text-3xl font-black mb-1">ğŸ—‘ï¸ ê°ˆì•„! (ì •ë¦¬ ê°€ëŠ¥)</h2>
                    <p class="text-sm font-bold">4ì„± ì´í•˜ì˜ ë¬´ê¸°ë“¤ë§Œ ì´ ê¸°ì§ˆì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
                `;
            }
        }

        // --- ë¡œì§ í•¨ìˆ˜: ë¬´ê¸° ì¹´ë“œ HTML ìƒì„± ---
        function createWeaponCard(w, index) {
            const styles = getRarityStyles(w.rarity);
            
            const imageHtml = w.image ? 
                `<img src="${w.image}" class="w-full h-full object-contain p-2" alt="${w.name}" onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');">
                 <div class="hidden flex flex-col items-center"><span class="text-3xl mb-2">ğŸš«</span><span class="text-xs text-gray-500 text-center">ì´ë¯¸ì§€ ì—†ìŒ</span></div>` : 
                `<span class="text-4xl text-gray-600">âš”ï¸</span>`;

            return `
                <div id="weapon-${index}" class="group border-gray-700">
                    <div onclick="toggleAccordion(${index})" class="grid grid-cols-12 gap-4 px-6 py-5 cursor-pointer hover:bg-gray-750 items-center">
                        <div class="col-span-5 md:col-span-4">
                            <div class="flex items-center gap-2">
                                <span class="arrow-icon text-blue-400 text-xs">â–¼</span>
                                <span class="text-lg font-black ${styles.text} transition">${w.name}</span>
                            </div>
                            <div class="flex items-center gap-1.5 mt-1 ml-5">
                                <span class="text-[11px] px-1.5 py-0.5 bg-gray-700 text-gray-300 rounded font-bold">${w.type}</span>
                                <span class="text-[11px] font-black px-1.5 py-0.5 rounded border ${styles.badge}">â˜… ${w.rarity}</span>
                            </div>
                        </div>
                        <div class="hidden md:block col-span-3 text-center text-base font-bold text-gray-200">
                            ${w.recommend || '-'}
                        </div>
                        <div class="col-span-7 md:col-span-5 flex flex-wrap justify-end md:justify-start gap-1">
                            ${w.tags.map(t => `<span class="text-xs bg-gray-900 border border-gray-700 px-2 py-1 rounded text-gray-300 font-bold">${t}</span>`).join('')}
                        </div>
                    </div>
                    <div class="details-content bg-gray-900/50 px-6">
                        <div class="py-6 grid grid-cols-1 md:grid-cols-3 gap-6 border-t border-gray-800">
                            <div class="flex items-center justify-center bg-gray-800 rounded-lg overflow-hidden border border-gray-700 min-h-[200px] relative">
                                ${imageHtml}
                            </div>
                            <div class="space-y-4">
                                <div><h4 class="text-xs font-bold text-gray-500 uppercase mb-1">Main Stat</h4><p class="text-xl font-black text-blue-200">${w.main_stat}</p></div>
                                <div><h4 class="text-xs font-bold text-gray-500 uppercase mb-1">Sub Stat</h4><p class="text-lg font-semibold text-green-400">${w.sub_stat}</p></div>
                            </div>
                            <div>
                                <h4 class="text-xs font-bold text-gray-500 uppercase mb-2 text-blue-400">ì¥ë¹„ íš¨ê³¼</h4>
                                <div class="text-base font-medium leading-relaxed text-gray-300 whitespace-pre-line">${w.effects}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- ë©”ì¸ ë Œë”ë§ í•¨ìˆ˜ ---
        function updateUI() {
            const list = document.getElementById('weapon-list');
            const sortedWeapons = [...weapons].sort((a, b) => (b.rarity || 0) - (a.rarity || 0));
            
            const filtered = sortedWeapons.filter(w => 
                Array.from(activeTags).every(t => w.tags.includes(t))
            );

            updateDecisionBox(filtered);

            if (filtered.length === 0) {
                // ë¦¬ìŠ¤íŠ¸ì—ëŠ” ì•„ë¬´ê²ƒë„ í‘œì‹œí•˜ì§€ ì•ŠìŒ (ê°€ì´ë“œ ë°•ìŠ¤ì—ì„œ 'ê°ˆì•„'ë¼ê³  ì•Œë ¤ì£¼ë¯€ë¡œ)
                list.innerHTML = `<div class="p-12 text-center text-gray-500 opacity-50">ì¼ì¹˜í•˜ëŠ” ë¬´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            } else {
                list.innerHTML = filtered.map((w, index) => createWeaponCard(w, index)).join('');
            }
        }

        // --- íƒœê·¸ ë Œë”ë§ ---
        function renderTags() {
            const containers = {
                stats: document.getElementById('tags-stats'),
                attrs: document.getElementById('tags-attrs'),
                series: document.getElementById('tags-series')
            };
            Object.values(containers).forEach(el => el.innerHTML = '');

            allTags.forEach(tag => {
                let category = 'attrs';
                if (CATEGORIES.stats.includes(tag)) category = 'stats';
                else if (CATEGORIES.series.includes(tag)) category = 'series';

                const isActive = activeTags.has(tag);
                const btnColor = isActive ? 'bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-500/30' : 'border-gray-600 text-gray-400 hover:bg-gray-700 hover:text-gray-200';
                
                const btn = document.createElement('button');
                btn.className = `px-3 py-1.5 rounded border text-sm font-bold transition duration-200 ${btnColor}`;
                btn.textContent = tag;
                btn.onclick = () => toggleTag(tag);
                
                containers[category].appendChild(btn);
            });
        }

        function toggleTag(tag) {
            activeTags.has(tag) ? activeTags.delete(tag) : activeTags.add(tag);
            renderTags();
            updateUI();
        }

        function resetFilters() {
            activeTags.clear();
            renderTags();
            updateUI();
        }

        function toggleAccordion(index) {
            document.getElementById(`weapon-${index}`).classList.toggle('details-open');
        }

        loadData();
    </script>
</body>
</html>