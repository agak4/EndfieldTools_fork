<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê¸°ì§ˆ ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .details-open .details-content { max-height: 500px; transition: max-height 0.5s ease-in; }
        .arrow-icon { transition: transform 0.3s; }
        .details-open .arrow-icon { transform: rotate(180deg); }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center text-blue-400">ê¸°ì§ˆ ê³„ì‚°ê¸°</h1>

        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8 border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <label class="font-semibold text-gray-300">ğŸ” ê¸°ì§ˆ í•„í„°</label>
                <button onclick="resetFilters()" class="text-sm text-gray-500 hover:text-white underline">ì „ì²´ ì´ˆê¸°í™”</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-blue-400 uppercase tracking-widest border-b border-gray-700 pb-1">ëŠ¥ë ¥ì¹˜</h3>
                    <div id="tags-stats" class="flex flex-wrap gap-2"></div>
                </div>
                
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-green-400 uppercase tracking-widest border-b border-gray-700 pb-1">ì†ì„±</h3>
                    <div id="tags-attrs" class="flex flex-wrap gap-2"></div>
                </div>
                
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-purple-400 uppercase tracking-widest border-b border-gray-700 pb-1">ì‹œë¦¬ì¦ˆ ìŠ¤í‚¬</h3>
                    <div id="tags-series" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-12 gap-4 px-6 py-3 bg-gray-700 rounded-t-xl font-black text-gray-200 text-base">
            <div class="col-span-5 md:col-span-4">ë¬´ê¸° ì´ë¦„</div>
            <div class="hidden md:block col-span-3 text-center">ì¶”ì²œ ìºë¦­í„°</div>
            <div class="col-span-7 md:col-span-5 text-right md:text-left">ê¸°ì§ˆ</div>
        </div>

        <div id="weapon-list" class="bg-gray-800 rounded-b-xl shadow-2xl divide-y divide-gray-700 border-x border-b border-gray-700">
            </div>
    </div>

    <script>
        let weapons = [];
        let allTags = [];
        let activeTags = new Set();

        async function loadData() {
            try {
                const response = await fetch('data.json');
                weapons = await response.json();
                allTags = [...new Set(weapons.flatMap(w => w.tags))].sort();
                renderTags();
                renderWeapons();
            } catch (error) {
                console.error("Data load error:", error);
            }
        }

        //ì‹ê° ì¹´í…Œê³ ë¦¬ ì •ì˜
        const categories = {
            stats: ["ë¯¼ì²© ì¦ê°€", "í˜ ì¦ê°€", "ì˜ì§€ ì¦ê°€", "ì§€ëŠ¥ ì¦ê°€", "ì£¼ìš” ëŠ¥ë ¥ì¹˜ ì¦ê°€"],
            attrs: ["ê³µê²©ë ¥ ì¦ê°€", "ìƒëª…ë ¥ ì¦ê°€", "ë¬¼ë¦¬ í”¼í•´ ì¦ê°€", "ì—´ê¸° í”¼í•´ ì¦ê°€", "ì „ê¸° í”¼í•´ ì¦ê°€", "ëƒ‰ê¸° í”¼í•´ ì¦ê°€", "ìì—° í”¼í•´ ì¦ê°€", "ì¹˜ëª…íƒ€ í™•ë¥  ì¦ê°€", "ì˜¤ë¦¬ì§€ëŠ„ ì•„ì¸  ì¦ê°€", "ì˜¤ë¦¬ì§€ëŠ„ ì•„ì¸  ê°•ë„ ì¦ê°€", "ê¶ê·¹ê¸° íšë“ íš¨ìœ¨ ì¦ê°€", "ê¶ê·¹ê¸° ì¶©ì „ íš¨ìœ¨ ì¦ê°€", "ì•„ì¸  í”¼í•´ ì¦ê°€", "ì¹˜ìœ  íš¨ìœ¨ ì¦ê°€"],
            series: ["ê°•ê³µ", "ì–µì œ", "ì¶”ê²©", "ë¶„ì‡„", "ì‚¬ê¸°", "ê¸°ì˜ˆ", "ì”í˜¹", "ê³ í†µ", "ì˜ë£Œ", "ê³¨ì ˆ", "ë°©ì¶œ", "ì–´ë‘ ", "íë¦„", "íš¨ìœ¨"]
        };

        function renderTags() {
            //ì‹ê° ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const containers = {
                stats: document.getElementById('tags-stats'),
                attrs: document.getElementById('tags-attrs'),
                series: document.getElementById('tags-series')
            };
            
            Object.keys(containers).forEach(key => containers[key].innerHTML = '');

            allTags.forEach(tag => {
                // íƒœê·¸ê°€ ì–´ëŠ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ”ì§€ í™•ì¸
                let category = 'attrs'; // ê¸°ë³¸ê°’
                if (categories.stats.includes(tag)) category = 'stats';
                else if (categories.series.includes(tag)) category = 'series';

                const btnColor = activeTags.has(tag) ? 'bg-blue-600 border-blue-600 text-white' : 'border-gray-600 text-gray-400 hover:bg-gray-700';
                
                const btn = `
                    <button onclick="toggleTag('${tag}')" 
                        class="px-3 py-1.5 rounded border text-sm font-bold transition ${btnColor}">
                        ${tag}
                    </button>
                `;
                
                containers[category].innerHTML += btn;
            });
        }

        function toggleTag(tag) {
            activeTags.has(tag) ? activeTags.delete(tag) : activeTags.add(tag);
            renderTags();
            renderWeapons();
        }

        function resetFilters() {
            activeTags.clear();
            renderTags();
            renderWeapons();
        }

        function toggleAccordion(id) {
            const element = document.getElementById(`weapon-${id}`);
            element.classList.toggle('details-open');
        }

        function renderWeapons() {
            const list = document.getElementById('weapon-list');
            
            // 1. í¬ê·€ë„(rarity) ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (6ì„± -> 3ì„±)
            // ì›ë³¸ ë°ì´í„° ë³´ì¡´ì„ ìœ„í•´ spread ì—°ì‚°ì(...)ë¥¼ ì‚¬ìš©í•´ ë³µì‚¬ë³¸ì„ ì •ë ¬í•©ë‹ˆë‹¤.
            const sortedWeapons = [...weapons].sort((a, b) => (b.rarity || 0) - (a.rarity || 0));

            // 2. í™œì„±í™”ëœ íƒœê·¸ í•„í„°ë§ ì ìš©
            const filtered = sortedWeapons.filter(w => 
                Array.from(activeTags).every(t => w.tags.includes(t))
            );

            // í¬ê·€ë„ë³„ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì •ì˜
            const rarityColor = {
                6: 'text-orange-400', // ì „ì„¤
                5: 'text-yellow-200', // ì—í”½
                4: 'text-purple-300', // í¬ê·€
                3: 'text-blue-200'    // ì¼ë°˜
            };

            list.innerHTML = filtered.map((w, index) => `
                <div id="weapon-${index}" class="group border-gray-700">
                    <div onclick="toggleAccordion(${index})" class="grid grid-cols-12 gap-4 px-6 py-5 cursor-pointer hover:bg-gray-750 items-center">
                        <div class="col-span-5 md:col-span-4">
                            <div class="flex items-center gap-2">
                                <span class="arrow-icon text-blue-400 text-xs">â–¼</span>
                                <span class="text-lg font-black ${rarityColor[w.rarity] || 'text-blue-300'} transition">${w.name}</span>
                            </div>
                            <div class="flex items-center gap-1.5 mt-1 ml-5">
                                <span class="text-[11px] px-1.5 py-0.5 bg-gray-700 text-gray-300 rounded font-bold">
                                    ${w.type}
                                </span>
                                <span class="text-[11px] font-black px-1.5 py-0.5 rounded border ${
                                    w.rarity == 6 ? 'text-orange-400 border-orange-400/50 bg-orange-400/10 shadow-[0_0_8px_rgba(251,146,60,0.2)]' :
                                    w.rarity == 5 ? 'text-yellow-200 border-yellow-200/50 bg-yellow-200/10' :
                                    w.rarity == 4 ? 'text-purple-300 border-purple-300/50 bg-purple-300/10' :
                                    'text-blue-200 border-blue-200/50 bg-blue-200/10'
                                }">
                                    â˜… ${w.rarity}
                                </span>
                            </div>
                        </div>
                        
                        <div class="hidden md:block col-span-3 text-center text-base font-bold text-gray-200">
                            ${w.recommend || '-'}
                        </div>

                        <div class="col-span-7 md:col-span-5 flex flex-wrap justify-end md:justify-start gap-1">
                            ${w.tags.map(t => `<span class="text-xs bg-gray-900 border border-gray-700 px-2 py-1 rounded text-gray-300 font-bold">${t}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="details-content bg-gray-900/50 px-6">
                        <div class="py-6 grid grid-cols-1 md:grid-cols-3 gap-6 border-t border-gray-800">
                            <div class="flex items-center justify-center bg-gray-800 rounded-lg overflow-hidden border border-gray-700 min-h-[200px] relative">
                                ${w.image ? 
                                    `<img src="${w.image}" 
                                        class="w-full h-full object-contain p-2" 
                                        alt="${w.name}"
                                        onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');">
                                    <div class="hidden flex flex-col items-center">
                                        <span class="text-3xl mb-2">ğŸš«</span>
                                        <span class="text-xs text-gray-500 text-center">ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>(íŒŒì¼ëª… í™•ì¸ í•„ìš”)</span>
                                    </div>` 
                                    : `<span class="text-4xl text-gray-600">âš”ï¸</span>`
                                }
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Main Stat</h4>
                                    <p class="text-xl font-black text-blue-200">${w.main_stat}</p>
                                </div>
                                <div>
                                    <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Sub Stat</h4>
                                    <p class="text-lg font-semibold text-green-400">${w.sub_stat}</p>
                                </div>
                            </div>

                            <div>
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 text-blue-400">ì¥ë¹„ íš¨ê³¼</h4>
                                <div class="text-base font-medium leading-relaxed text-gray-300 whitespace-pre-line">
                                    ${w.effects}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            if (filtered.length === 0) {
                list.innerHTML = `<div class="p-12 text-center text-gray-500">ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            }
        }

        loadData();
    </script>
</body>
</html>